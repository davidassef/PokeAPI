<div class="details-modal-overlay" (click)="onClose($event)" [@modalEnter]>
  <div class="details-modal-container" (click)="$event.stopPropagation()">

    <!-- Header otimizado com layout lado a lado -->
    <div class="pokemon-header-optimized" [@headerPulse]="headerState"
         [style.background]="pokemonTheme?.gradient">

      <!-- Seção da imagem com carrossel -->
      <div class="pokemon-image-section">
        <div class="image-carousel-container">
          <!-- Setas de navegação -->
          <button class="carousel-nav prev"
                  (click)="previousCarouselImage()"
                  [disabled]="carouselImages.length <= 1"
                  *ngIf="carouselImages.length > 1">
            <i class="fas fa-chevron-left"></i>
          </button>

          <!-- Imagem principal -->
          <div class="main-image-container">
            <img
              *ngIf="currentCarouselImage"
              [src]="currentCarouselImage"
              [alt]="pokemon?.name"
              class="pokemon-main-image-large"
              (error)="onImageError($event)"
            />
            <div *ngIf="!currentCarouselImage" class="pokemon-placeholder-large">
              <i class="fas fa-question"></i>
            </div>
          </div>

          <button class="carousel-nav next"
                  (click)="nextCarouselImage()"
                  [disabled]="carouselImages.length <= 1"
                  *ngIf="carouselImages.length > 1">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

        <!-- Miniaturas em linha (máximo 3 visíveis) -->
        <div class="carousel-thumbnails-inline" *ngIf="carouselImages.length > 1">
          <div class="thumbnails-slider"
               [style.transform]="'translateX(' + getThumbnailSlideOffset() + 'px)'">
            <button
              *ngFor="let image of carouselImages; let i = index"
              class="thumbnail-btn-inline"
              [class.active]="i === currentCarouselIndex"
              (click)="selectCarouselImage(i)">
              <img [src]="image.url" [alt]="image.label" (error)="onImageError($event)">
            </button>
          </div>
        </div>
      </div>

      <!-- Seção das informações dividida em duas partes -->
      <div class="pokemon-info-section">
        <!-- Info Section 1: Nome e Badges -->
        <div class="pokemon-info-section-1">
          <div class="pokemon-name-header">
            <h1>{{ pokemon?.name | titlecase }}</h1>
            <div class="pokemon-id-badge">#{{ (pokemon?.id ?? 0) | pokemonId }}</div>
          </div>

          <div class="pokemon-types-container">
            <span
              *ngFor="let type of pokemon?.types"
              class="type-badge interactive-element"
              [ngClass]="'type-' + type.type.name">
              {{ getTranslatedTypeName(type.type.name) }}
            </span>
          </div>
        </div>

        <!-- Info Section 2: Informações Básicas -->
        <div class="pokemon-info-section-2">
          <div class="pokemon-info-horizontal">
            <div class="info-item">
              <i class="fas fa-ruler-vertical"></i>
              <span class="info-value">{{ (pokemon?.height ?? 0) / 10 }}m</span>
              <span class="info-label">Altura</span>
            </div>
            <div class="info-item">
              <i class="fas fa-weight"></i>
              <span class="info-value">{{ (pokemon?.weight ?? 0) / 10 }}kg</span>
              <span class="info-label">Peso</span>
            </div>
            <div class="info-item">
              <i class="fas fa-star"></i>
              <span class="info-value">{{ getBaseExperience() }}</span>
              <span class="info-label">EXP Base</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sistema de abas -->
    <div class="modal-tabs" role="tablist" aria-label="Informações do Pokémon">
      <button
        role="tab"
        [attr.aria-selected]="activeTab === 'overview'"
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')"
        (keydown)="onTabKeydown($event)">
        <i class="fas fa-eye"></i>
        Visão Geral
      </button>
      <button
        role="tab"
        [attr.aria-selected]="activeTab === 'combat'"
        [class.active]="activeTab === 'combat'"
        (click)="setActiveTab('combat')"
        (keydown)="onTabKeydown($event)">
        <i class="fas fa-sword"></i>
        Combate
      </button>
      <button
        role="tab"
        [attr.aria-selected]="activeTab === 'evolution'"
        [class.active]="activeTab === 'evolution'"
        (click)="setActiveTab('evolution')"
        (keydown)="onTabKeydown($event)">
        <i class="fas fa-arrow-up"></i>
        Evolução
      </button>
      <button
        role="tab"
        [attr.aria-selected]="activeTab === 'curiosities'"
        [class.active]="activeTab === 'curiosities'"
        (click)="setActiveTab('curiosities')"
        (keydown)="onTabKeydown($event)">
        <i class="fas fa-star"></i>
        Curiosidades
      </button>
    </div>

    <!-- Conteúdo das abas -->
    <div class="tab-content" [@tabSlide]="activeTab">
      <ng-container *ngIf="activeTab === 'overview'">
        <div class="overview-content" [@fadeInStagger]>
          <div class="stats-grid">
            <div class="stat-card interactive-element" *ngFor="let stat of pokemon?.stats">
              <span class="stat-label">{{ getTranslatedStatName(stat.stat.name) }}</span>
              <div class="stat-bar">
                <div class="stat-fill"
                     [style.width.%]="(stat.base_stat / 255) * 100"
                     [@statBarFill]="{ value: '', params: { percentage: (stat.base_stat / 255) * 100 } }">
                </div>
              </div>
              <span class="stat-value">{{ stat.base_stat }}</span>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="activeTab === 'combat'">
        <div class="combat-content" [@fadeInStagger]>
          <div class="combat-stats-detailed">
            <h3><i class="fas fa-sword"></i> Estatísticas de Combate</h3>

            <!-- Total de status -->
            <div class="total-stats-card">
              <div class="stat-total">
                <span class="total-label">Total Base</span>
                <span class="total-value">{{ getTotalStats() }}</span>
              </div>
            </div>

            <!-- Stats detalhadas com categorias -->
            <div class="stats-categories">
              <div class="category offensive">
                <h4><i class="fas fa-bolt"></i> Ofensivas</h4>
                <div class="stat-row" *ngFor="let stat of getOffensiveStats()">
                  <span class="stat-name">{{ getTranslatedStatName(stat.stat.name) }}</span>
                  <div class="stat-progress">
                    <div class="progress-bar">
                      <div class="progress-fill offensive-fill"
                           [style.width.%]="getStatPercentage(stat.base_stat)">
                      </div>
                    </div>
                    <span class="stat-value">{{ stat.base_stat }}</span>
                  </div>
                </div>
              </div>

              <div class="category defensive">
                <h4><i class="fas fa-shield-alt"></i> Defensivas</h4>
                <div class="stat-row" *ngFor="let stat of getDefensiveStats()">
                  <span class="stat-name">{{ getTranslatedStatName(stat.stat.name) }}</span>
                  <div class="stat-progress">
                    <div class="progress-bar">
                      <div class="progress-fill defensive-fill"
                           [style.width.%]="getStatPercentage(stat.base_stat)">
                      </div>
                    </div>
                    <span class="stat-value">{{ stat.base_stat }}</span>
                  </div>
                </div>
              </div>

              <div class="category utility">
                <h4><i class="fas fa-tachometer-alt"></i> Utilidade</h4>
                <div class="stat-row" *ngFor="let stat of getUtilityStats()">
                  <span class="stat-name">{{ getTranslatedStatName(stat.stat.name) }}</span>
                  <div class="stat-progress">
                    <div class="progress-bar">
                      <div class="progress-fill utility-fill"
                           [style.width.%]="getStatPercentage(stat.base_stat)">
                      </div>
                    </div>
                    <span class="stat-value">{{ stat.base_stat }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Habilidades -->
            <div class="abilities-section" *ngIf="pokemon?.abilities?.length">
              <h4><i class="fas fa-magic"></i> Habilidades</h4>
              <div class="abilities-grid">
                <div class="ability-card"
                     *ngFor="let ability of pokemon?.abilities"
                     [ngClass]="{ 'hidden': ability.is_hidden }">
                  <div class="ability-header">
                    <span class="ability-name">{{ getTranslatedAbilityName(ability.ability.name) }}</span>
                    <span class="ability-type" *ngIf="ability.is_hidden">Oculta</span>
                  </div>
                  <p class="ability-description" *ngIf="getTranslatedAbilityDescription(ability.ability.name)">
                    {{ getTranslatedAbilityDescription(ability.ability.name) }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="activeTab === 'evolution'">
        <div class="evolution-content" [@fadeInStagger]>
          <h3><i class="fas fa-arrow-up"></i> Evolução</h3>

          <div class="evolution-info" *ngIf="evolutionChain && evolutionChain.length > 1; else noEvolution">
            <div class="evolution-chain">
              <div class="evolution-stage"
                   *ngFor="let stage of evolutionChain; let i = index"
                   [ngClass]="{ 'current': stage.id === pokemon?.id }">

                <div class="pokemon-evolution-card">
                  <div class="evolution-image">
                    <img [src]="stage.image" [alt]="stage.name"
                         (error)="onImageError($event)">
                  </div>
                  <div class="evolution-info-text">
                    <h4>{{ stage.name | titlecase }}</h4>
                    <span class="evolution-level" *ngIf="stage.level">
                      Nível {{ stage.level }}
                    </span>
                    <span class="evolution-method" *ngIf="stage.method && stage.method !== 'level'">
                      {{ getEvolutionMethodText(stage.method) }}
                    </span>
                  </div>
                </div>

                <!-- Seta de evolução -->
                <div class="evolution-arrow" *ngIf="i < evolutionChain.length - 1">
                  <i class="fas fa-arrow-right"></i>
                  <span class="evolution-trigger" *ngIf="evolutionChain[i + 1].trigger">
                    {{ evolutionChain[i + 1].trigger }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noEvolution>
            <div class="no-evolution">
              <i class="fas fa-star"></i>
              <p>Este Pokémon não possui evolução conhecida.</p>
            </div>
          </ng-template>

          <!-- Informações adicionais sobre evolução -->
          <div class="evolution-details" *ngIf="pokemon">
            <div class="detail-card">
              <h4><i class="fas fa-info-circle"></i> Informações de Crescimento</h4>
              <div class="growth-info">
                <p><strong>Grupo de Ovos:</strong> {{ getEggGroups() }}</p>
                <p><strong>Taxa de Crescimento:</strong> {{ getGrowthRate() }}</p>
                <p><strong>Experiência Base:</strong> {{ getBaseExperience() }}</p>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="activeTab === 'curiosities'">
        <div class="curiosities-content" [@fadeInStagger]>
          <h3><i class="fas fa-star"></i> Curiosidades</h3>

          <!-- Flavor texts -->
          <div class="flavor-section" *ngIf="flavorTexts && flavorTexts.length > 0">
            <h4><i class="fas fa-book"></i> Descrições</h4>
            <div class="flavor-container">
              <div class="flavor-text-display">
                <div class="flavor-text-wrapper"
                     #flavorTextWrapper
                     (scroll)="onFlavorTextScroll($event)">
                  <p class="flavor-text">{{ getCurrentFlavorText() }}</p>
                  <div class="scroll-indicator"
                       *ngIf="showScrollIndicator"
                       [@fadeInOut]="showScrollIndicator ? 'visible' : 'hidden'">
                    <i class="fas fa-chevron-down"></i>
                    <span>Há mais texto</span>
                  </div>
                </div>
                <div class="flavor-controls" *ngIf="flavorTexts.length > 1">
                  <button class="flavor-nav-btn"
                          (click)="previousFlavor()"
                          [disabled]="currentFlavorIndex === 0">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <span class="flavor-counter">
                    {{ currentFlavorIndex + 1 }} / {{ flavorTexts.length }}
                  </span>
                  <button class="flavor-nav-btn"
                          (click)="nextFlavor()"
                          [disabled]="currentFlavorIndex === flavorTexts.length - 1">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Dados físicos e biológicos -->
          <div class="biological-info">
            <h4><i class="fas fa-dna"></i> Características Físicas</h4>
            <div class="bio-grid">
              <div class="bio-item">
                <i class="fas fa-ruler-vertical"></i>
                <span class="bio-label">Altura</span>
                <span class="bio-value">{{ (pokemon?.height ?? 0) / 10 }}m</span>
              </div>
              <div class="bio-item">
                <i class="fas fa-weight"></i>
                <span class="bio-label">Peso</span>
                <span class="bio-value">{{ (pokemon?.weight ?? 0) / 10 }}kg</span>
              </div>
              <div class="bio-item">
                <i class="fas fa-calculator"></i>
                <span class="bio-label">IMC</span>
                <span class="bio-value">{{ getPokemonBMI() }}</span>
              </div>
            </div>
          </div>

          <!-- Raridade e captura -->
          <div class="capture-info" *ngIf="speciesData">
            <h4><i class="fas fa-target"></i> Informações de Captura</h4>
            <div class="capture-grid">
              <div class="capture-item">
                <i class="fas fa-crosshairs"></i>
                <span class="capture-label">Taxa de Captura</span>
                <span class="capture-value">{{ getCaptureRate() }}</span>
              </div>
              <div class="capture-item">
                <i class="fas fa-heart"></i>
                <span class="capture-label">Felicidade Base</span>
                <span class="capture-value">{{ getBaseHappiness() }}</span>
              </div>
              <div class="capture-item">
                <i class="fas fa-eye"></i>
                <span class="capture-label">Cor</span>
                <span class="capture-value">{{ getPokemonColor() }}</span>
              </div>
            </div>
          </div>

          <!-- Trivia e fatos interessantes -->
          <div class="trivia-section">
            <h4><i class="fas fa-lightbulb"></i> Você Sabia?</h4>
            <div class="trivia-list">
              <div class="trivia-item" *ngFor="let fact of getPokemonTrivia()">
                <i class="fas fa-star"></i>
                <p>{{ fact }}</p>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Botão de fechar -->
    <button class="close-button interactive-element" (click)="onClose()" aria-label="Fechar modal">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>