<ion-menu side="start" menuId="main-menu" contentId="main-content">
  <ion-header>
    <ion-toolbar class="menu-header">
      <div class="header-content">
        <div class="logo-section">
          <img src="assets/img/pokedex.png" alt="Pokédex" class="logo" style="width:56px;height:56px;object-fit:contain;margin-right:12px;" />
          <div class="app-info">
            <h2>{{ 'app.name' | translate }}</h2>
            <p>{{ 'app.version' | translate }} 1.0.0</p>
          </div>
        </div>

        <ion-button fill="clear" (click)="closeMenu()" class="close-btn">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>

        <!-- Botão Login/Saudação -->
        <ng-container *ngIf="!isAuthenticated">
          <!-- Removido botão de login do sidemenu -->
        </ng-container>
        <ng-container *ngIf="isAuthenticated && user">
          <div class="user-greeting" (click)="toggleUserMenu()" style="margin-left: 12px; cursor: pointer; display: flex; align-items: center;">
            <span>{{ 'user.greeting' | translate }}, {{ user.firstName || user.name || 'Treinador' }}!</span>
            <ion-icon name="chevron-down-outline" style="margin-left: 4px;"></ion-icon>
          </div>
          <div class="user-dropdown" *ngIf="showUserMenu" style="position: absolute; right: 16px; top: 56px; background: var(--ion-background-color, #222); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); min-width: 200px; z-index: 1000;">
            <div style="padding: 12px; border-bottom: 1px solid #444;">
              <div><strong>{{ user.name }}</strong></div>
              <div style="font-size: 0.9em; color: #aaa;">{{ user.email }}</div>
              <div style="font-size: 0.9em; color: #aaa;">{{ 'user.level' | translate }}: {{ user.level || '1' }}</div>
            </div>
            <ion-item button (click)="abrirPerfil()">{{ 'user.profile_settings' | translate }}</ion-item>
            <ion-item button (click)="logout()">{{ 'user.logout' | translate }}</ion-item>
          </div>
        </ng-container>
      </div>
    </ion-toolbar>
  </ion-header>

  <ion-content class="menu-content">
    <!-- User Stats Section -->
    <div class="user-stats-section">
      <h3>{{ 'menu.your_progress' | translate }}</h3>

      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-icon">
            <ion-icon name="eye-outline" color="primary"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ userStats.seenCount }}</span>
            <span class="stat-label">{{ 'menu.seen' | translate }}</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <ion-icon name="cube-outline" color="success"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ userStats.capturedCount }}</span>
            <span class="stat-label">{{ 'menu.captured' | translate }}</span>
          </div>
        </div>
      </div>

      <!-- Progress Bars -->
      <div class="progress-section">
        <div class="progress-item">
          <div class="progress-header">
            <span>{{ 'menu.completion' | translate }}</span>
            <span>{{ getCompletionPercentage() }}%</span>
          </div>
          <ion-progress-bar
            [value]="getCompletionPercentage() / 100"
            color="primary">
          </ion-progress-bar>
        </div>

        <div class="progress-item">
          <div class="progress-header">
            <span>{{ 'menu.capture_rate' | translate }}</span>
            <span>{{ getCaptureRate() }}%</span>
          </div>
          <ion-progress-bar
            [value]="getCaptureRate() / 100"
            color="success">
          </ion-progress-bar>
        </div>
      </div>
    </div>

    <!-- Main Navigation -->
    <div class="navigation-section">
      <h3>{{ 'menu.navigation' | translate }}</h3>
      <ion-list class="menu-list">
        <ion-item
          *ngFor="let item of menuItems"
          button
          (click)="onMenuItemClick(item)"
          class="menu-item">

          <ion-icon
            [name]="item.icon"
            [color]="item.color"
            slot="start">
          </ion-icon>

          <ion-label>
            <h3>{{ item.title | translate }}</h3>
          </ion-label>

          <ion-badge
            *ngIf="item.badge && item.badge > 0"
            [color]="item.color"
            slot="end">
            {{ item.badge }}
          </ion-badge>

          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            class="chevron">
          </ion-icon>
        </ion-item>
      </ion-list>
    </div>

    <!-- Language Selector -->
    <div class="language-section">
      <h3>{{ 'menu.language' | translate }}</h3>
      <ion-list class="language-list">
        <ion-item
          *ngFor="let lang of availableLanguages"
          button
          (click)="changeLanguage(lang.code)"
          [class.selected]="currentLanguage === lang.code"
          class="language-item">

          <div class="language-flag" slot="start">{{ lang.flag }}</div>

          <ion-label>
            <h3>{{ ('languages.' + lang.code) | translate }}</h3>
          </ion-label>

          <ion-icon
            *ngIf="currentLanguage === lang.code"
            name="checkmark-circle"
            color="success"
            slot="end">
          </ion-icon>
        </ion-item>
      </ion-list>
    </div>
  </ion-content>
</ion-menu>
