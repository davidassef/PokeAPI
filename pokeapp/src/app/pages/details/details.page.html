<!-- Header compartilhado com botão de voltar -->
<app-shared-header
  [title]="pokemon ? getFormattedName() + ' #' + pokemon.id.toString().padStart(3, '0') : ('loading.details' | translate)"
  [showBackButton]="true"
  [currentPage]="appPages.DETAILS">
  <!-- Slot para conteúdo customizado do header (botão favorito) -->
  <ion-buttons slot="end" *ngIf="pokemon">
    <ion-button (click)="toggleFavorite()" [disabled]="!pokemon" fill="clear">
      <ion-icon
        [name]="isFavorite ? 'heart' : 'heart-outline'"
        [color]="isFavorite ? 'danger' : 'light'"
        [attr.aria-label]="isFavorite ? ('details.removeFromFavorites' | translate) : ('details.addToFavorites' | translate)">
      </ion-icon>
    </ion-button>
  </ion-buttons>
</app-shared-header>

<!-- Breadcrumb Navigation -->
<app-breadcrumb
  [items]="breadcrumbItems"
  *ngIf="breadcrumbItems.length > 0 && !isLoading">
</app-breadcrumb>

<ion-content [fullscreen]="true">
  <!-- Loading moderno -->
  <app-pokemon-loading
    *ngIf="isLoading"
    [config]="{ type: 'pokeball', message: 'loading.details' | translate, subMessage: 'loading.pokemonData' | translate }"
    [isVisible]="isLoading">
  </app-pokemon-loading>

  <!-- Conteúdo principal -->
  <div class="pokemon-details" *ngIf="!isLoading && pokemon">
    <!-- Header com gradiente -->
    <div class="pokemon-header" [style.background]="'linear-gradient(135deg, ' + getPrimaryTypeColor() + ', ' + getPrimaryTypeColor() + '88)'">      <div class="main-image-container">
        <img
          [src]="imageUrls[0] || getPokemonMainImageUrl()"
          [alt]="pokemon.name"
          class="main-pokemon-image">
      </div>
    </div>

    <!-- Informações básicas -->
    <div class="basic-info">
      <div class="info-cards">
        <ion-card class="info-card">
          <ion-card-header>
            <ion-card-title>{{ 'details.info' | translate }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="info-grid">              <div class="info-item">
                <span class="label">{{ 'stats.height' | translate }}:</span>
                <span class="value">{{ (pokemon.height || 0) / 10 }}m</span>
              </div>
              <div class="info-item">
                <span class="label">{{ 'stats.weight' | translate }}:</span>
                <span class="value">{{ (pokemon.weight || 0) / 10 }}kg</span>
              </div>
              <div class="info-item">
                <span class="label">{{ 'stats.experience' | translate }}:</span>
                <span class="value">{{ pokemon.base_experience || 0 }}</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Tipos -->
        <ion-card class="info-card">
          <ion-card-header>
            <ion-card-title>{{ 'stats.types' | translate }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="types-container">
              <ion-chip
                *ngFor="let typeInfo of pokemon.types"
                class="type-chip"
                [style.background-color]="getTypeColor(typeInfo.type.name)">
                <ion-label>{{ typeInfo.type.name | titlecase }}</ion-label>
              </ion-chip>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Stats -->
    <ion-card class="stats-card" *ngIf="stats.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="bar-chart-outline"></ion-icon>
          {{ 'details.baseStats' | translate }}
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-item" *ngFor="let stat of stats">
            <div class="stat-header">
              <span class="stat-name">{{ stat.name }}</span>
              <span class="stat-value">{{ stat.value }}</span>
            </div>
            <div class="stat-bar">
              <div class="stat-fill"
                   [style.width.%]="getStatPercentage(stat.value, stat.max)"
                   [style.background-color]="getPrimaryTypeColor()">
              </div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Habilidades -->
    <ion-card class="abilities-card" *ngIf="pokemon.abilities && pokemon.abilities.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="flash-outline"></ion-icon>
          {{ 'stats.abilities' | translate }}
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="abilities-grid">
          <ion-chip
            *ngFor="let abilityInfo of pokemon.abilities"
            class="ability-chip"
            [class.hidden-ability]="abilityInfo.is_hidden">
            <ion-label>
              {{ abilityInfo.ability.name | titlecase }}
              <span *ngIf="abilityInfo.is_hidden" class="hidden-label">({{ 'abilities.hidden' | translate }})</span>
            </ion-label>
          </ion-chip>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Galeria de imagens -->
    <ion-card class="images-card" *ngIf="imageUrls.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="images-outline"></ion-icon>
          {{ 'details.gallery' | translate }} ({{ imageUrls.length }} {{ 'details.images' | translate }})
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="images-grid">
          <div class="image-item" *ngFor="let imageUrl of imageUrls; let i = index">
            <img
              [src]="imageUrl"
              [alt]="pokemon.name + ' ' + ('details.image' | translate) + ' ' + (i + 1)"
              class="gallery-image"
              loading="lazy">
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Descrições -->
    <ion-card class="descriptions-card" *ngIf="descriptions.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="document-text-outline"></ion-icon>
          {{ 'details.descriptions' | translate }} ({{ descriptions.length }})
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="descriptions-list">
          <div class="description-item" *ngFor="let description of descriptions; let i = index">
            <div class="description-number">{{ i + 1 }}</div>
            <p class="description-text">{{ description }}</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
