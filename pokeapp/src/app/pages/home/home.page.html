<app-shared-header
  [title]="'nav.pokedex' | translate"
  [subtitle]="'home.subtitle' | translate"
  [currentPage]="appPages.HOME">
</app-shared-header>

<ion-content [fullscreen]="true">
  <!-- Header transparente para mobile -->
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ 'nav.pokedex' | translate }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Barra de busca -->
  <div class="search-container">
    <ion-searchbar
      [(ngModel)]="searchTerm"
      [placeholder]="'search.placeholder' | translate"
      (ionInput)="onSearchChange($event)"
      (ionClear)="clearSearch()"
      show-clear-button="focus"
      debounce="200"
      class="modern-search">
    </ion-searchbar>

    <!-- Filtros rÃ¡pidos -->
    <div class="quick-filters" *ngIf="!isLoading">
      <div class="filters-header">
        <h4>{{ 'filters.title' | translate }}</h4>
        <span class="results-count" *ngIf="searchTerm || hasActiveFilters()">
          {{ filteredPokemon.length }} {{ 'home.totalFound' | translate }}
        </span>
      </div>      <div class="filters-grid">
        <ion-chip
          *ngFor="let filter of quickFilters"
          (click)="toggleFilter(filter)"
          class="filter-chip"
          [class.active]="filter.active"
          [style.--chip-color]="filter.color"
          [style.--chip-background]="filter.backgroundColor"
          [style.--chip-text-color]="filter.textColor">
          <ion-icon [name]="filter.icon"></ion-icon>
          <ion-label>{{ filter.label | translate }}</ion-label>
        </ion-chip>
      </div>

      <!-- BotÃ£o limpar filtros -->
      <ion-button
        fill="clear"
        size="small"
        (click)="clearAllFilters()"
        *ngIf="hasActiveFilters()"
        class="clear-filters-btn">        <ion-icon name="close-circle-outline" slot="start"></ion-icon>
        {{ 'filters.clearAll' | translate }}
      </ion-button>
    </div>
  </div>  <!-- Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content
      refreshing-spinner="circles">
    </ion-refresher-content>
  </ion-refresher>
  <!-- Loading inicial -->
  <div class="loading-container" *ngIf="isLoading && pokemons.length === 0">
    <div class="pokeball-loader">
      <div class="pokeball-top"></div>
      <div class="pokeball-center"></div>
      <div class="pokeball-bottom"></div>
    </div>
    <h3>{{ 'loading.title' | translate }}</h3>
    <p>{{ 'loading.subtitle' | translate }}</p>
    <p><small>Debug: {{ pokemons.length }} {{ 'nav.pokedex' | translate }}</small></p>
  </div>

  <!-- Skeleton Loading -->
  <div class="skeleton-loading" *ngIf="isLoading && pokemons.length === 0">
    <div class="pokemon-grid">
      <div class="skeleton-card" *ngFor="let item of [1,2,3,4,5,6,7,8]"></div>
    </div>
  </div>

  <!-- Lista de PokÃ©mons -->
  <div class="pokemon-section">
    <!-- Indicador de filtros ativos -->
    <div class="active-filters-indicator" *ngIf="hasActiveFilters() || searchTerm">
      <div class="indicator-content">
        <ion-icon name="funnel-outline"></ion-icon>
        <span>
          {{ filteredPokemon.length }} de {{ allLoadedPokemon.length }} PokÃ©mons
          <span *ngIf="hasActiveFilters()"> â€¢ {{ 'filters.active' | translate }}</span>
          <span *ngIf="searchTerm"> â€¢ {{ 'search.resultsFor' | translate }}: "{{ searchTerm }}"</span>
        </span>
      </div>
    </div>    <!-- Lista Regular (para poucos itens) -->
    <div class="pokemon-grid" *ngIf="!isLoading && filteredPokemon.length > 0 && filteredPokemon.length <= 50">
      <app-pokemon-card
        *ngFor="let pokemon of filteredPokemon; trackBy: trackByPokemonId"
        [pokemon]="pokemon"
        [localizedName]="getLocalizedPokemonName(pokemon)"
        [isFavorite]="isFavorite(pokemon.id)"
        [showFavoriteButton]="true"
        (cardClick)="goToDetails($event)"
        (favoriteToggle)="toggleFavorite($event)">
      </app-pokemon-card>
    </div>

    <!-- Virtual Scrolling (para muitos itens) -->
    <cdk-virtual-scroll-viewport
      *ngIf="!isLoading && filteredPokemon.length > 50"
      [itemSize]="itemSize"
      [minBufferPx]="minBufferPx"
      [maxBufferPx]="maxBufferPx"
      class="virtual-scroll-viewport">

      <div class="pokemon-grid virtual-grid">
        <app-pokemon-card
          *cdkVirtualFor="let pokemon of filteredPokemon; trackBy: trackByPokemonId"
          [pokemon]="pokemon"
          [localizedName]="getLocalizedPokemonName(pokemon)"
          [isFavorite]="isFavorite(pokemon.id)"
          [showFavoriteButton]="true"
          (cardClick)="goToDetails($event)"
          (favoriteToggle)="toggleFavorite($event)">
        </app-pokemon-card>
      </div>
    </cdk-virtual-scroll-viewport>
  </div>  <!-- Estado vazio -->
  <div class="empty-state" *ngIf="!isLoading && filteredPokemon.length === 0">
    <div class="empty-animation">
      <div class="empty-pokeball">
        <div class="pokeball-bounce">ðŸ”´</div>
      </div>
    </div>

    <!-- Mensagem quando hÃ¡ busca -->
    <div *ngIf="searchTerm && !hasActiveFilters()">
      <h3>{{ 'search.noResults' | translate }}</h3>
      <p class="search-text">
        {{ 'search.tryDifferentTerm' | translate }}
      </p>
    </div>

    <!-- Mensagem quando hÃ¡ filtros ativos -->
    <div *ngIf="hasActiveFilters() && !searchTerm">
      <h3>{{ 'filters.noResults' | translate }}</h3>
      <p class="filter-text">
        {{ 'filters.noResultsMessage' | translate }}
      </p>
    </div>

    <!-- Mensagem quando hÃ¡ busca E filtros -->
    <div *ngIf="searchTerm && hasActiveFilters()">
      <h3>{{ 'filters.noResultsCombined' | translate }}</h3>
      <p class="filter-text">
        {{ 'filters.tryDifferentCriteria' | translate }}
      </p>
    </div>

    <!-- Mensagem de erro de carregamento -->
    <div *ngIf="!searchTerm && !hasActiveFilters()">
      <h3>{{ 'error.loadingData' | translate }}</h3>
      <p class="error-text">
        {{ 'error.tryAgain' | translate }}
      </p>
    </div>

    <div class="empty-actions">
      <ion-button
        fill="outline"
        (click)="clearSearch()"
        *ngIf="searchTerm"
        class="action-button">
        <ion-icon name="close-circle-outline" slot="start"></ion-icon>
        {{ 'search.clearSearch' | translate }}
      </ion-button>

      <ion-button
        fill="outline"
        (click)="clearAllFilters()"
        *ngIf="hasActiveFilters()"
        class="action-button">
        <ion-icon name="funnel-outline" slot="start"></ion-icon>
        {{ 'filters.clearAll' | translate }}
      </ion-button>

      <ion-button
        fill="solid"
        (click)="refreshList()"
        *ngIf="!searchTerm && !hasActiveFilters()"
        class="action-button">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        {{ 'common.retry' | translate }}
      </ion-button>
    </div>
  </div><!-- Infinite Scroll -->
  <ion-infinite-scroll
    threshold="100px"
    (ionInfinite)="loadMore($event)"
    *ngIf="hasMore && !isSearching">
    <ion-infinite-scroll-content
      loading-spinner="bubbles">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
