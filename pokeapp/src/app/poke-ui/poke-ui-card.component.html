<!--
  ÔøΩ POK√âCARD √âPICO - Design System Limpo e Funcional
  ‚ö° Foco em Funcionalidade, Performance e Acessibilidade
  üéØ Vers√£o Refatorada para Corre√ß√£o de Bugs Cr√≠ticos
-->
<article
  class="poke-card"
  [class]="getCardClasses()"
  [style.--primary-color]="getPrimaryTypeColor()"
  [style.--secondary-color]="getSecondaryTypeColor()"
  [attr.data-type]="getPrimaryType()"
  [attr.data-rarity]="getRarityLevel()"
  tabindex="0"
  role="button"
  [attr.aria-label]="getAccessibleLabel()"
  [attr.aria-describedby]="'pokemon-' + pokemon.id + '-description'"
  (click)="onCardClick()"
  (keydown.enter)="onCardClick()"
  (keydown.space)="onCardClick()"
  (mouseenter)="onCardHover(true)"
  (mouseleave)="onCardHover(false)"
  (focus)="onCardFocus(true)"
  (blur)="onCardFocus(false)">

  <!-- ‚ù§Ô∏è Bot√£o de Favorito -->
  <button
    class="poke-fav-btn"
    [class.favorito]="isFavorito"
    [class.shiny]="isShiny"
    (click)="onToggleFavorito($event)"
    [attr.aria-label]="getFavoriteButtonLabel()"
    [attr.title]="getFavoriteButtonLabel()">
    <span class="fav-icon" aria-hidden="true">
      {{ isFavorito ? '‚ù§Ô∏è' : 'ü§ç' }}
    </span>
  </button>

  <!-- üè∑Ô∏è Badge de Raridade -->
  <div class="rarity-badge"
       [class]="'rarity-' + getRarityLevel()"
       *ngIf="isShiny || isLegendary()"
       aria-hidden="true">
    <span class="rarity-icon">{{ getRarityIcon() }}</span>
  </div>  <!-- üñºÔ∏è Container da Imagem -->
  <div class="poke-card-img-container">
    <!-- Background glow baseado no tipo -->
    <div class="type-glow"
         [attr.data-type]="getPrimaryType()"
         aria-hidden="true"></div>

    <img
      class="pokemon-sprite"
      [src]="getImageUrl()"
      [alt]="'Imagem do Pok√©mon ' + pokemon.name"
      loading="lazy"
      (error)="onImageError($event)"
      (load)="onImageLoad()"
      [class.shiny]="isShiny"
      [class.loaded]="imageLoaded"
      [class.error]="imageError" />

    <!-- Loading placeholder -->
    <div class="image-placeholder"
         *ngIf="!imageLoaded && !imageError"
         aria-hidden="true">
      <div class="loading-spinner-small"></div>
      <div class="placeholder-text">#{{ pokemon.id | number:'3.0-0' }}</div>
    </div>

    <!-- Error placeholder -->
    <div class="image-error"
         *ngIf="imageError"
         aria-hidden="true">
      <div class="error-icon">‚ùå</div>
      <div class="error-text">Imagem n√£o encontrada</div>
    </div>

    <!-- Overlay Shiny com anima√ß√£o -->
    <div class="shiny-overlay"
         *ngIf="isShiny"
         aria-hidden="true">
      <div class="sparkle sparkle-1">‚ú®</div>
      <div class="sparkle sparkle-2">‚≠ê</div>
      <div class="sparkle sparkle-3">üí´</div>
    </div>
  </div>
  <!-- üìä Informa√ß√µes do Pok√©mon -->
  <div class="poke-card-info">
    <!-- Header com ID e Nome -->
    <div class="pokemon-header">
      <div class="pokemon-id-display">
        <span class="pokemon-id" aria-label="N√∫mero da Pok√©dex">
          #{{ pokemon.id | number:'3.0-0' }}
        </span>
      </div>

      <!-- Nome do Pok√©mon -->
      <h2 class="pokemon-name">
        <span class="name-text">{{ formatPokemonName(pokemon.name) }}</span>
        <span class="shiny-indicator"
              *ngIf="isShiny"
              aria-label="Pok√©mon Shiny Raro"
              title="Pok√©mon Shiny Raro">
          ‚ú®
        </span>
      </h2>
    </div>

    <!-- üé® Badges de Tipo -->
    <div class="pokemon-types"
         role="list"
         aria-label="Tipos do Pok√©mon"
         *ngIf="pokemon.types && pokemon.types.length > 0">
      <div class="type-badge"
           *ngFor="let pokemonType of pokemon.types; trackBy: trackByType"
           role="listitem"
           [ngClass]="getTypeClass(pokemonType.type.name)"
           [style.--type-color]="getTypeColor(pokemonType.type.name)"
           [attr.data-type]="pokemonType.type.name"
           [attr.title]="'Tipo ' + formatTypeName(pokemonType.type.name)">
        <span class="type-icon" aria-hidden="true">{{ getTypeIcon(pokemonType.type.name) }}</span>
        <span class="type-name">{{ formatTypeName(pokemonType.type.name) }}</span>
      </div>
    </div>

    <!-- ‚ö° N√≠vel de Poder -->
    <div class="power-level-display">
      <div class="power-label">
        <span class="power-icon" aria-hidden="true">‚ö°</span>
        <span class="power-text">Poder</span>
      </div>
      <div class="power-bar" aria-hidden="true">
        <div class="power-fill"
             [style.width.%]="getPowerLevel()"
             [style.background]="getPowerGradient()">
        </div>
      </div>
      <span class="power-percentage"
            [attr.aria-label]="'N√≠vel de poder: ' + getPowerLevel() + '%'">
        {{ getPowerLevel() }}%
      </span>
    </div>

    <!-- üìè Estat√≠sticas B√°sicas -->
    <div class="pokemon-stats"
         *ngIf="pokemon.height || pokemon.weight">
      <div class="stats-grid">
        <div class="stat-item" *ngIf="pokemon.height">
          <span class="stat-icon" aria-hidden="true">üìè</span>
          <span class="stat-label">Altura</span>
          <span class="stat-value">{{ (pokemon.height / 10) | number:'1.1-1' }}m</span>
        </div>
        <div class="stat-item" *ngIf="pokemon.weight">
          <span class="stat-icon" aria-hidden="true">‚öñÔ∏è</span>
          <span class="stat-label">Peso</span>
          <span class="stat-value">{{ (pokemon.weight / 10) | number:'1.1-1' }}kg</span>
        </div>
      </div>
    </div>

    <!-- üéØ Experi√™ncia Base (se dispon√≠vel) -->
    <div class="experience-display"
         *ngIf="pokemon.base_experience">
      <span class="exp-label">EXP</span>
      <span class="exp-value">{{ pokemon.base_experience }}</span>
    </div>
  </div>

  <!-- üîç Estado de Loading/An√°lise -->
  <div class="loading-overlay"
       *ngIf="isMaterializing"
       aria-hidden="true">
    <div class="loading-spinner"></div>
    <div class="loading-text">Carregando...</div>
  </div>

  <!-- ÔøΩ Descri√ß√£o Acess√≠vel -->
  <div
    [id]="'pokemon-' + pokemon.id + '-description'"
    class="sr-only">
    {{ getAccessibleDescription() }}
  </div>

</article>
