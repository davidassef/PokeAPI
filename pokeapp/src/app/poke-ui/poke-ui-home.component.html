<!-- üåü Home √âpico - Portal Principal da Pok√©dex Interativa -->
<poke-ui-header
  (favoritesClick)="onHeaderFavorites($event)"
  (advancedSearchClick)="onAdvancedSearch($event)"
  (menuToggle)="onMenuToggle($event)"
  (logoClick)="onLogoClick($event)">
</poke-ui-header>

<main
  class="epic-main"
  role="main"
  [attr.aria-label]="'Pok√©dex Interativa - ' + (filteredPokemon$ | async)?.length + ' Pok√©mon encontrados'"
  [class.main-loading]="(loadingState$ | async)?.initial"
  [class.main-empty]="(filteredPokemon$ | async)?.length === 0">
  <!-- Portal de Entrada -->
  <div class="entrance-portal portal-active" aria-hidden="true">
    <div class="portal-core"></div>
    <div class="portal-rings">
      <div class="ring" *ngFor="let ring of portalRings; trackBy: trackPortalRing"
           [style.width.px]="ring.size"
           [style.height.px]="ring.size"
           [style.--ring-delay.s]="ring.delay"
           [style.border-color]="ring.color">
      </div>
    </div>
  </div>

  <!-- Part√≠culas Ambientais -->
  <div class="ambient-particles" aria-hidden="true">
    <div class="particle-system">      <div class="particle" *ngFor="let particle of ambientParticles; trackBy: trackParticle"
           [style.left.%]="particle.x"
           [style.top.%]="particle.y"
           [style.width.px]="particle.size"
           [style.height.px]="particle.size"
           [style.--duration.s]="particle.speed"
           [style.background-color]="particle.color"
           [class.particle-small]="particle.size < 4"
           [class.particle-large]="particle.size > 6">
      </div>
    </div>
  </div>

  <!-- Controles √âpicos de Busca e Filtro -->
  <section class="epic-controls" role="search" aria-label="Controles de busca e filtro">

    <!-- Barra de Busca Futurista -->
    <div class="search-container">
      <div class="search-wrapper">
        <div class="search-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
        </div>

        <input
          type="search"
          class="epic-search"
          placeholder="Buscar Pok√©mon por nome..."
          [attr.aria-label]="'Buscar entre ' + (totalPokemonCount$ | async) + ' Pok√©mon dispon√≠veis'"
          [value]="(searchTerm$ | async) || ''"
          (input)="onSearchChange($any($event.target).value)"
          (focus)="onSearchFocus(true)"
          (blur)="onSearchFocus(false)"
          [class.search-focused]="isSearchFocused"
          autocomplete="off"
          spellcheck="false" />

        <div class="search-glow" aria-hidden="true"></div>

        <!-- Contador de Resultados -->
        <div class="search-counter" *ngIf="(filteredPokemon$ | async)?.length !== undefined">
          <span class="counter-text">{{ (filteredPokemon$ | async)?.length }}</span>
          <span class="counter-label">encontrado{{ (filteredPokemon$ | async)?.length !== 1 ? 's' : '' }}</span>
        </div>
      </div>
    </div>

    <!-- Filtros Avan√ßados -->
    <div class="filters-container">

      <!-- Seletor de Tipo -->
      <div class="filter-group">
        <label class="filter-label" for="type-select">
          <span class="label-icon" aria-hidden="true">‚ö°</span>
          <span class="label-text">Tipo</span>
        </label>

        <div class="select-wrapper">
          <select
            id="type-select"
            class="epic-select"
            [value]="(filterConfig$ | async)?.selectedType || ''"
            (change)="onTypeChange($any($event.target).value)"
            [attr.aria-label]="'Filtrar por tipo elemental'">
            <option value="">Todos os tipos</option>
            <option *ngFor="let tipo of availableTypes$ | async; trackBy: trackByType"
                    [value]="tipo">{{ getTypeDisplayName(tipo) }}</option>
          </select>

          <div class="select-arrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 10l5 5 5-5z"/>
            </svg>
          </div>

          <div class="select-glow" aria-hidden="true"></div>
        </div>
      </div>

      <!-- Toggle de Favoritos -->
      <div class="filter-group">
        <button
          type="button"
          class="epic-toggle-btn"
          [class.toggle-active]="(filterConfig$ | async)?.showOnlyFavorites"
          [attr.aria-pressed]="(filterConfig$ | async)?.showOnlyFavorites"
          [attr.aria-label]="(filterConfig$ | async)?.showOnlyFavorites ? 'Mostrar todos os Pok√©mon' : 'Mostrar apenas favoritos'"
          (click)="onToggleFavorites()">

          <div class="toggle-icon" aria-hidden="true">
            <svg class="icon-heart" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </div>

          <span class="toggle-text">
            {{ (filterConfig$ | async)?.showOnlyFavorites ? 'Todos' : 'Favoritos' }}
          </span>

          <div class="toggle-counter" *ngIf="favoritesCount > 0">
            {{ favoritesCount }}
          </div>

          <div class="toggle-glow" aria-hidden="true"></div>
        </button>
      </div>

      <!-- Bot√£o de Reset -->
      <div class="filter-group">
        <button
          type="button"
          class="epic-reset-btn"
          (click)="onResetFilters()"
          [disabled]="!(hasActiveFilters$ | async)"
          aria-label="Limpar todos os filtros">

          <div class="reset-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/>
            </svg>
          </div>

          <span class="reset-text">Reset</span>

          <div class="reset-glow" aria-hidden="true"></div>
        </button>
      </div>
    </div>
  </section>

  <!-- Estados de Loading √âpico -->
  <section
    *ngIf="(loadingState$ | async)?.initial || (loadingState$ | async)?.loadingMore"
    class="epic-loading"
    role="status"
    aria-live="polite"
    [attr.aria-label]="getLoadingMessage()">

    <div class="loading-portal" aria-hidden="true">
      <div class="portal-spinner">
        <div class="spinner-ring" *ngFor="let ring of spinnerRings; let i = index"
             [style.--ring-size.px]="ring.size"
             [style.--ring-delay.s]="ring.delay"
             [style.--ring-color]="ring.color">
        </div>
      </div>
    </div>

    <div class="loading-content">
      <h2 class="loading-title">{{ getLoadingTitle() }}</h2>
      <p class="loading-subtitle">{{ getLoadingSubtitle() }}</p>

      <!-- Barra de Progresso -->
      <div class="progress-container" *ngIf="(loadingProgress$ | async) !== undefined">
        <div class="progress-bar">
          <div class="progress-fill"
               [style.width.%]="(loadingProgress$ | async)"
               [attr.aria-valuenow]="(loadingProgress$ | async)"
               aria-valuemin="0"
               aria-valuemax="100">
          </div>
        </div>
        <span class="progress-text">{{ (loadingProgress$ | async) }}% carregado</span>
      </div>
    </div>
  </section>

  <!-- Estado Vazio √âpico -->
  <section
    *ngIf="!(loadingState$ | async)?.initial && !(loadingState$ | async)?.loadingMore && (filteredPokemon$ | async)?.length === 0"
    class="epic-empty"
    role="status"
    aria-live="polite">

    <div class="empty-illustration" aria-hidden="true">
      <div class="pokeball-container">
        <img src="assets/img/pokeball-placeholder.png" alt="" class="pokeball-image" />
        <div class="pokeball-glow"></div>
      </div>
    </div>

    <div class="empty-content">
      <h2 class="empty-title">{{ getEmptyTitle() }}</h2>
      <p class="empty-message">{{ getEmptyMessage() }}</p>

      <div class="empty-actions">
        <button
          type="button"
          class="epic-action-btn"
          (click)="onResetFilters()"
          *ngIf="hasActiveFilters$ | async">
          <span>Limpar Filtros</span>
        </button>

        <button
          type="button"
          class="epic-action-btn secondary"
          (click)="onRandomPokemon()">
          <span>Pok√©mon Aleat√≥rio</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Grid √âpico de Pok√©mon -->
  <section
    *ngIf="!(loadingState$ | async)?.initial && !(loadingState$ | async)?.loadingMore && (filteredPokemon$ | async)?.length && (filteredPokemon$ | async)!.length > 0"
    class="epic-grid"
    role="region"
    [attr.aria-label]="'Grade com ' + (filteredPokemon$ | async)?.length + ' Pok√©mon'"
    [class.grid-filtered]="hasActiveFilters$ | async"
    [class.grid-favorites]="(filterConfig$ | async)?.showOnlyFavorites">

    <!-- Cards de Pok√©mon -->
    <poke-ui-card
      *ngFor="let pokemon of filteredPokemon$ | async; trackBy: trackByPokemonId; let i = index"
      [pokemon]="pokemon"
      [isFavorito]="isFavorite(pokemon.id)"
      (cardClick)="onCardClick(pokemon)"
      (toggleFavorito)="onToggleFavorite(pokemon)"
      [attr.aria-posinset]="i + 1"
      [attr.aria-setsize]="(filteredPokemon$ | async)?.length">
    </poke-ui-card>

    <!-- Bot√£o Load More -->
    <div class="load-more-container" *ngIf="(hasMorePokemon$ | async) && !(loadingState$ | async)?.loadingMore">
      <button
        type="button"
        class="epic-load-more-btn"
        (click)="onLoadMore()"
        [attr.aria-label]="'Carregar mais Pok√©mon. Atualmente exibindo ' + (filteredPokemon$ | async)?.length + ' de ' + (totalPokemonCount$ | async)">

        <div class="load-more-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
          </svg>
        </div>

        <span class="load-more-text">Carregar Mais</span>

        <div class="load-more-glow" aria-hidden="true"></div>
      </button>
    </div>
  </section>

  <!-- Componentes Integrados -->
  <poke-ui-detail-modal
    *ngIf="selectedPokemon"
    [pokemon]="selectedPokemon"
    (close)="onCloseModal()"
    (next)="onNextPokemon()"
    (prev)="onPreviousPokemon()">
  </poke-ui-detail-modal>

  <!-- Painel de Conquistas -->
  <poke-ui-achievements
    [achievements]="achievements"
    [class.achievements-visible]="(showAchievements$ | async)">
  </poke-ui-achievements>

  <!-- Ranking -->
  <poke-ui-ranking
    [class.ranking-visible]="(showRanking$ | async)">
  </poke-ui-ranking>

  <!-- Bot√£o Pok√©mon Aleat√≥rio -->
  <poke-ui-random-btn
    (random)="onRandomPokemon()"
    class="floating-random-btn">
  </poke-ui-random-btn>

  <!-- Efeitos Atmosf√©ricos -->
  <div class="atmospheric-effects" aria-hidden="true">
    <div class="effect-lightning"></div>
    <div class="effect-sparkles"></div>
    <div class="effect-energy-waves"></div>
  </div>

</main>

<!-- Footer √âpico -->
<footer class="epic-footer" role="contentinfo">
  <div class="footer-content">
    <div class="footer-brand">
      <span class="brand-text">Pok√©dex Interativa</span>
      <span class="brand-subtitle">Feito com Angular & ‚ù§Ô∏è</span>
    </div>

    <div class="footer-stats" *ngIf="(appStats$ | async) as stats">
      <div class="stat-item">
        <span class="stat-value">{{ stats.totalPokemon }}</span>
        <span class="stat-label">Pok√©mon</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ stats.favoriteCount }}</span>
        <span class="stat-label">Favoritos</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ stats.typesDiscovered }}</span>
        <span class="stat-label">Tipos Descobertos</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ stats.achievementsUnlocked }}</span>
        <span class="stat-label">Conquistas</span>
      </div>
    </div>
  </div>

  <div class="footer-glow" aria-hidden="true"></div>
</footer>
